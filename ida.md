# Изучение Ассемблера через IDA pro [Link](https://wasm.in/blogs/vvedenie-v-reversing-s-nulja-ispolzuja-ida-pro-chast-2.4/)

## Системы счисления
* ДВОИЧНАЯ: Числа представляются двумя символами 0 и 1, вот почему она называется ДВОИЧНАЯ.
* ДЕСЯТИЧНАЯ: Все числа представляются с помощью 10 символов(от 0 до 9), вот почему она называется ДЕСЯТИЧНАЯ.
* ШЕСТНАДЦАТЕРИЧНАЯ: Все числа представляются с помощью символов от 0 до F ( от 0 до 9, далее A, B, C, D, E и F, или 16 символов в итоге).
* В нижней части IDA есть один коммандбар, чтобы исполнять команды PYTHON, он поможет переводить числа из одной системы в другую
  * ***0b*** означает двоичное представление числа
  * ***0x*** вначале числа конвертирует его в 16-ную систему : ***0x45*** = 69
  * Для 16-ных hex() : ***hex(69)*** = 0x45
  * Для двоичного  bin() : ***bin(69)*** = 0b1000101
  * Для символов chr() : ***chr(0x45)*** = E
* Для удобного управления преобразованиями в IDA есть калькулятор ***VIEW - CALCULATOR***
  * В 32-битных двоичных числах первый бит используется для знака числа, 0 = плюс, 1 = минус
  * ***7FFFFFFF*** : 2147483647 в десятичной (максимальное положительное число)
  * ***FFFFFFFF*** : -1 в десятичной
  * ***80000000*** : -2147483648 в десятичной (максимальное отрицательное число)

## Возможности поиска (пункт SEARCH)
* next code - поиск след. кода : CODE
* next data - поиск след. данных : DATA
* next [un]explored - поиск след. [не]распознанного блока
* next immediate - поиск след. непосредственного значения
* next text - поиск совпадения по тексту
* sequance binary - поиск последовательности байт
* not function - поиск неразобранных функций

## Data type
<table>
  <tr>
    <th>Data Type</th>
    <th>Bytes</th>
  </tr>
  <tr>
    <td>BYTE, SBYTE</td>
    <td>1</td>
  </tr>
  <tr>
    <td>WORD, SWORD</td>
    <td>2</td>
  </tr>
  <tr>
    <td>DWORD, SDWORD</td>
    <td>4</td>
  </tr>
  <tr>
    <td>FWORD</td>
    <td>6</td>
  </tr>
  <tr>
    <td>QWORD</td>
    <td>8</td>
  </tr>
  <tr>
    <td>TBYTE</td>
    <td>10</td>
  </tr>
</table>

## Регистры 32-битные
* ***EAX*** - аккумулятор + 16 бит - AX(8 бит AH + AL)
* ***EBX*** - база + 16 бит - BX(8 бит BH + BL)
* ***ECX*** - счетчик + 16 бит - CX(8 бит CH + CL)
* ***EDX*** - данные + 16 бит - DX(8 бит DH + DL)
* ***ESP*** - указатель на вершину стека
* ***EBP*** - указатель на базу стека
* ***ESI*** - указатель на источник данных
* ***EDI*** - указатель на назначенные данные

## Сегментные регистры
* ***CS*** - CODE Segment
* ***DS*** - DATA Segment
* ***SS*** - STACK Segment
* ***ES*** - Extra
* ***FS*** - Extra
* ***GS*** - Extra

## IAT (таблица с адресами внешних функций, при запуске)
* ***.idata*** - раздел (розовые строки)
* ***IAT*** - пустой и заполняется при запуске программы
* ***extrn*** - означает что это внешняя функция

## Инструкции
* ***OFFSET*** - передача самого адреса (не значения)
* ***dword_*** - передача данных типа DWORD
* ***stru_*** - передача данных типа структура
* ***loc_*** - локальная метка
* ***sub_*** - метка функции (ПКМ->Create function)
* ***Клавиша D*** - преобразование в DATA вид
* ***Клавиша A*** - преобразование в ASCII вид

### Изменение кода (плагин [github](https://github.com/keystone-engine/keypatch) [Keypatch](https://drive.google.com/file/d/0B13TW0I0f8O2eU1VdUJzVjdYTWs/view?usp=sharing))
***ПКМ->Keypatch->Patcher*** или ***Ctrl+Alt+K***
```
Во второй ссылке находится файл keypatch.py, 
который мы должны скопировать в каталог плагинов IDA 
и затем можно установить keystone-0.9.1-python-win32.msi.

Кроме того, необходимо установить Microsoft VC ++, 
библиотеку времени исполнения.
```

### MOV А, В (копирование из В в А)
Примеры :
* ***MOV EAX, EDI*** 
* ***MOV EAX, 1***
* ***MOV EAX, dword_46F908*** - передача содержимого адреса
* ***MOV EAX, offset dword_46F908*** - передача самого адреса 
* ***MOV EAX, DWORD PTR DS:[46F908]***
* ***MOV EAX, [EDI]*** - квадратные скобки если IDA не знает что в EDI
* ***MOV AL, 1***

### XCHG A, B (обмен значениями)
* ***XCHG EAX, ESI***
* ***XCHG EAX, DS:dword_4020DC*** - обмен EAX c содержимым адреса 4020DC

### PUSH (положить в стек)
* ***push 64h*** - положить в стек 0x64
* ***push eax*** - положить в стек значение из EAX
* ***push offset byte_4020E7*** - положить в стек адрес памяти (например адрес начало строки)

Передача аргумента к функциям : ***PUSH offset xxxxx***

### POP (вытащить из стека)
* ***pop edi*** - вершина стека в edi (esp меняется на след. в стеке)
* ***pop esi***
* ***pop ebx***

### Параметры в функциях в IDA
* В функциях обнаруженных IDA есть параметры.
* Передаются через ***PUSH*** который стоит перед вызовом функции(***CALL***)
* ***PUSH*** сохраняет эти значения(параметры) в стеке
```assembly
00401170 var_24= byte ptr -24h 
00401170 var_18= byte ptr -18h 
00401170 var_14= dword ptr -14h 
00401170 var_10= dword ptr -10h 
00401170 var_C= dword ptr -0Ch 
00401170 var_4= dword ptr -24 
00401170 arg_0= dword ptr 8 
```

### LEA A, B  (помещает указанные ***адрес*** из В в А)
* Никогда не получает доступ к содержимому В
* Либо адрес, либо результат работы операции между квадратными скобками в В.
* Используется чтобы ***получить адреса переменых*** в памяти или ***параметров***.
* ***lea eax, [ebp+var_C]***